{"remainingRequest":"/home/zyx/workspaces/python/server_management/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/zyx/workspaces/python/server_management/client/src/components/DataTable.vue?vue&type=style&index=0&id=1bcc6778&lang=less&scoped=true&","dependencies":[{"path":"/home/zyx/workspaces/python/server_management/client/src/components/DataTable.vue","mtime":1621429765537},{"path":"/home/zyx/workspaces/python/server_management/client/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/zyx/workspaces/python/server_management/client/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/zyx/workspaces/python/server_management/client/node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/zyx/workspaces/python/server_management/client/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/zyx/workspaces/python/server_management/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/zyx/workspaces/python/server_management/client/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5kYXRhLXRhYmxlIHsKICB3aWR0aDogMTAwJTsKICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0KCi5kYXRhLXRhYmxlIC5wYWdpbmF0aW9uIHsKICBkaXNwbGF5OiBibG9jazsKICB0ZXh0LWFsaWduOiByaWdodDsKICBtYXJnaW4tdG9wOiAxNXB4OwogIHdpZHRoOiAxMDAlOwp9Ci5lbC10YWJsZSAud2FybmluZy1yb3cgewogIGJhY2tncm91bmQ6IG9sZGxhY2U7Cn0KCi5lbC10YWJsZSAuc3VjY2Vzcy1yb3cgewogIGJhY2tncm91bmQ6ICNmMGY5ZWI7Cn0K"},{"version":3,"sources":["DataTable.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2LA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"DataTable.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"data-table\">\n    <div class=\"search\"></div>\n\n    <div class=\"table\">\n      <el-table\n        :data=\"listData\"\n        :empty-text=\"emptyText\"\n        :default-sort=\"defaultSort\"\n        :row-class-name=\"tableRowClassName\"\n        @sort-change=\"sortChange\"\n        v-loading.body=\"showLoading\"\n        element-loading-text=\"拼命加载中\"\n        size=\"small\"\n        border\n      >\n        <slot name=\"columns\"></slot>\n      </el-table>\n    </div>\n\n    <div class=\"pagination\">\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"currentPageData\"\n        :page-sizes=\"pageSizes\"\n        :page-size=\"pageSizeData\"\n        layout=\"total, prev, pager, next, jumper, sizes\"\n        :total=\"total\"\n      >\n      </el-pagination>\n    </div>\n  </div>\n</template>\n<script>\nimport {apiCall} from '@/utils/api';\nimport settings from '@/settings';\nimport event from '@/utils/event';\n\nexport default {\n  name: 'DataTable',\n  props: {\n    // 默认排序\n    defaultSort: {\n      type: Object,\n    },\n    // 是否显示pageIndex列\n    showPageIndex: {\n      type: Boolean,\n      default: false,\n    },\n    // 没有数据显示文字\n    emptyText: {\n      type: String,\n      default: '暂无数据',\n    },\n    // 当前页数\n    currentPage: {\n      type: Number,\n      default: 1,\n    },\n    // 每页数据数量\n    pageSize: {\n      type: Number,\n      default: settings.PAGE_SIZE,\n    },\n    // 附加查询条件\n    queryParams: {\n      type: Object,\n    },\n    // 数据接口地址\n    apiUrl: {\n      type: String,\n    },\n    // 数据载入成功后回调\n    loadCallback: {\n      type: Function,\n      required: false,\n    },\n    //  是否默认渲染\n    defaultRender: {\n      type: Boolean,\n      required: false,\n      default: true,\n    },\n  },\n  data() {\n    return {\n      currentPageData: this.currentPage,\n      pageSizeData: this.pageSize,\n      pageSizes: [10, 20],\n      total: 0,\n      listData: [],\n      showLoading: false,\n      sortParams: {},\n    };\n  },\n  created: function() {\n    // 刷新全部数据\n    this.$on(event.REFRESH_ALL_DATA, function() {\n      this.reload();\n    });\n    // 刷新当前页数据\n    this.$on(event.REFRESH_CURRENT_DATA, function() {\n      this.load();\n    });\n    if (this.defaultRender) {\n      this.load();\n    }\n  },\n  methods: {\n    tableRowClassName({row, rowIndex}) {\n      if (rowIndex % 4 == 0) {\n        return 'success-row';\n      } else if (rowIndex % 2 == 0){\n        return 'warning-row';\n      }\n      return '';\n    },\n    handleSizeChange(val) {\n      this.pageSizeData = val;\n      this.load();\n    },\n    handleCurrentChange(val) {\n      this.currentPageData = val;\n      this.load();\n    },\n    reload() {\n      this.currentPageData = 1;\n      this.load();\n    },\n    // 排序改变，向参数注入排序字段\n    sortChange(sort) {\n      // 参数格式根据需要修改\n      this.sortParams = sort.prop\n        ? {\n            prop: sort.prop,\n            order: sort.order,\n          }\n        : {};\n      this.reload();\n    },\n    // 载入数据\n    load() {\n      this.showLoading = true;\n\n      const queryParams = Object.assign(\n        {\n          pageNum: this.currentPageData,\n          pageSize: this.pageSizeData,\n          order: this.sortParams,\n        },\n        this.queryParams\n      );\n      console.log(\"table call method:\", this.method);\n      apiCall({\n        url: this.apiUrl,\n        method: \"post\",\n        data: queryParams,\n      })\n        .then(d => {\n          console.log(\"get in data table:\", d);\n          let data = JSON.parse(d[\"data\"]);\n          this.listData =\n            data &&\n            data.map(function(item, index) {\n              // 增加序号\n              item.pageIndex = (queryParams.pageNum - 1) * queryParams.pageSize + index + 1;\n              return item;\n            });\n          this.total = d[\"total\"];\n          return data;\n        })\n        .then(d => {\n          if (this.loadCallback) {\n            this.loadCallback(d, queryParams);\n          }\n        })\n        .finally(() => {\n          this.showLoading = false;\n        });\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.data-table {\n  width: 100%;\n  position: relative;\n}\n\n.data-table .pagination {\n  display: block;\n  text-align: right;\n  margin-top: 15px;\n  width: 100%;\n}\n.el-table .warning-row {\n  background: oldlace;\n}\n\n.el-table .success-row {\n  background: #f0f9eb;\n}\n</style>\n"]}]}